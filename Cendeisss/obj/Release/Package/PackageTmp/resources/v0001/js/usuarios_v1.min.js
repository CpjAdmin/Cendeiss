function limpiarDataModal(){$("#modalTitulo").text();$("#ModalTxtUsuario").val("");$("#ModalTxtNombre").val("");$("#ModalDdlRol").val("1");$("#ModalTxtEmail").val("");$("#ModalDdlEstado").val("S");$("#ModalTxtClave").val("")}function verificarInputVacios(){var n=$("#ModalTxtUsuario").val(),t=$("#ModalTxtNombre").val(),i=$("#ModalTxtEmail").val(),r=$("#ModalTxtClave").val();if(n==="")$("#ModalTxtUsuario").focus();else if(t==="")$("#ModalTxtNombre").focus();else if(i==="")$("#ModalTxtEmail").focus();else if(r==="")$("#ModalTxtClave").focus();else return!1}function cerrarModalActualizar(){$("#modal_actualizar").modal("hide")}function iniciarDataTable(){tabla=objTabla.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4,5]},title:function(){return nombreReporte},sheetName:"Usuarios"}],language:{url:"resources/components/datatables-buttons/json/spanish.json"},fnDrawCallback:function(){var n=objTabla.DataTable();n.data().length===0?n.buttons(".dt-button").disable():n.buttons(".dt-button").enable()},aaSorting:[[1,"asc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-390+"px",scrollX:!0,scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!1,responsive:!0,aoColumns:[{sClass:"text-bold"},null,null,null,null,null,{bSortable:!1,sClass:"center"}]})}function fnEditar(n,t){return n==="ADMINISTRADOR"?'<button type="button" id="'+t+'" class="btn btn-xs btn-primary btn-editar btn_datatable" data-target="#modal_actualizar" data-toggle="modal"><i class="glyphicon glyphicon-pencil" aria-hidden="true"><\/i><\/button>':""}function agregarFilasDT(n){function r(n){return n==="Activo"?'<span class="label label-success" style="font-size:9px;">'+n+"<\/span>":'<span class="label label-danger"  style="font-size:9px;">'+n+"<\/span>"}var i,t;for(objTabla.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push([n[t].id,n[t].nombre,n[t].rol,n[t].email,r(n[t].estado),n[t].f_ult_ingreso,fnEditar(rol,n[t].id)]);objTabla.dataTable().fnAddData(i,!0)}function AjaxCargarRegistros(){$.ajax({type:"POST",url:"Usuarios.aspx/CargarRegistros",contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta="Error: "+n.status+"<br>"+n.responseJSON.Message;"\n"+i;mensajeError(MensajeAlerta,paginaURL);setTimeout(function(){window.location="./Login.aspx"},5e3);animacion!==undefined&&setTimeout(function(){dialogoProgreso.hide();dialogoProgreso.stopAnimate(animacion)},500)},success:function(n){n.d.length>0?agregarFilasDT(n.d):(MsjPersonalizado="No existen usuarios en la base de datos!",tipoMsj="info",Alerta("mensajesAlerta",MsjPersonalizado,tipoMsj,2e3))}}).done(function(){animacion!==undefined&&setTimeout(function(){dialogoProgreso.hide();dialogoProgreso.stopAnimate(animacion)},500)})}function ProcesarDataAjax(n){var t=JSON.stringify({p_usuario:$("#ModalTxtUsuario").val(),p_nombre:$("#ModalTxtNombre").val(),p_cod_rol:$("#ModalDdlRol").val(),p_email:$("#ModalTxtEmail").val(),p_clave:$("#ModalTxtClave").val(),p_i_estado:$("#ModalDdlEstado").val(),p_proceso:n,p_id:login});$.ajax({type:"POST",url:paginaURL+"/ProcesarUsuario",data:t,dataType:"json",contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta="Error: "+n.status+"<br>"+n.responseJSON.Message;"\n"+i;mensajeError(MensajeAlerta,paginaURL);setTimeout(function(){window.location="./Login.aspx"},5e3)},success:function(n){n.d?(MensajeAlerta="Usuario procesado correctamente.",Alerta("mensajesAlerta",MensajeAlerta,"success",2e3),AjaxCargarRegistros()):(MensajeAlerta="No se pudo procesar el Usuario.",Alerta("mensajesAlerta",MensajeAlerta,"danger",2e3))}})}function llenarDataModal(){$("#modalTitulo").text("ACTUALIZAR USUARIO");$("#ModalTxtUsuario").val(data[0]);$("#ModalTxtNombre").val(data[1]);$("#ModalDdlRol").val($("#ModalDdlRol option:contains('"+data[2]+"')").val());$("#ModalTxtEmail").val(data[3]);$("#ModalDdlEstado").val($("#ModalDdlEstado option:contains('"+$.parseHTML(data[4])[0].innerHTML+"')").val());$("#ModalTxtClave").val("        ")}var tabla,data,objTabla=$("#tbl_usuarios"),paginaURL="Usuarios.aspx",nombreReporte="Lista de Usuarios CENDEISSS",height,inicio,MensajeAlerta,tipoMsj,cod_proceso,animacion;$(document).ready(function(){dialogoProgreso.show('Cargando <span class="glyphicon glyphicon-hourglass"><\/span>');animacion=dialogoProgreso.animate();setTimeout(function(){iniciarDataTable();AjaxCargarRegistros()},1e3)});$(document).on("click",".btn-editar",function(n){n.preventDefault();$("#ModalTxtUsuario").attr("readonly",!0);var t=$(this).parent().parent()[0];data=objTabla.fnGetData(t);llenarDataModal();cod_proceso="U"});$(document).on("click","#btnRegistrar",function(n){n.preventDefault();$("#modalTitulo").text("REGISTRAR USUARIO");$("#ModalTxtUsuario").attr("readonly",!1);$("#modal_actualizar").modal("show");cod_proceso="C"});$(document).on("hidden.bs.modal","#modal_actualizar",function(){limpiarDataModal()});$("#btnModalProcesar").click(function(n){n.preventDefault();var t=verificarInputVacios();t===!1&&(ProcesarDataAjax(cod_proceso),$("#modal_actualizar").modal("hide"))});$("#btnModalCancelar").click(function(n){n.preventDefault();cerrarModalActualizar()});$(document).on("click","#btnRefrescar",function(n){n.preventDefault();AjaxCargarRegistros()});